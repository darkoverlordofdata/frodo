(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var DEBUG_MODE, currentlySelectedPlaceElement, displayFriends, displayMealList, displayPlaces, displaySelectedMeal, handleGenericError, handleOGSuccess, handlePublishOGError, handleStatusChange, logResponse, meals, menuHandler, myFriends, nearbyPlaces, publishOGAction, reauthorizeForPublishPermissions, selectedFriends, selectedMealIndex, selectedPlaceID, selectedPlaceIndex, showPublishConfirmation, updateUserInfo;

DEBUG_MODE = false;

selectedMealIndex = -1;

selectedPlaceIndex = -1;

selectedPlaceID = null;

nearbyPlaces = null;

myFriends = null;

currentlySelectedPlaceElement = null;

selectedFriends = {};

meals = [
  {
    id: "cheeseburger",
    title: "Cheeseburger",
    url: "http://nodescrumptious.azurewebsites.net/meals/cheeseburger"
  }, {
    id: "chinese",
    title: "Chinese",
    url: "http://nodescrumptious.azurewebsites.net/meals/chinese"
  }, {
    id: "french",
    title: "French",
    url: "http://nodescrumptious.azurewebsites.net/meals/french"
  }, {
    id: "hotdog",
    title: "Hot Dog",
    url: "http://nodescrumptious.azurewebsites.net/meals/hotdog"
  }, {
    id: "indian",
    title: "Indian",
    url: "http://nodescrumptious.azurewebsites.net/meals/indian"
  }, {
    id: "italian",
    title: "Italian",
    url: "http://nodescrumptious.azurewebsites.net/meals/italian"
  }, {
    id: "pizza",
    title: "Pizza",
    url: "http://nodescrumptious.azurewebsites.net/meals/pizza"
  }
];

logResponse = function(response) {
  if (typeof console !== "undefined") {
    return console.log("The response was", response);
  }
};

handleStatusChange = function(response) {
  if (response.authResponse) {
    logResponse(response);
    window.location.hash = "#menu";
    return updateUserInfo(response);
  } else {
    return window.location.hash = "#login";
  }
};

updateUserInfo = function(response) {
  return FB.api("/me", {
    fields: "name,first_name,picture"
  }, function(response) {
    var output;
    logResponse(response);
    output = "";
    output += "<img src=\"" + response.picture.data.url + "\" width=\"25\" height=\"25\"></img>";
    output += " " + response.first_name;
    return $("#user-identity").html(output);
  });
};

handleOGSuccess = function() {
  logResponse("[handleOGSuccess] done.");
  showPublishConfirmation();
  selectedMealIndex = -1;
  selectedPlaceIndex = -1;
  selectedPlaceID = null;
  currentlySelectedPlaceElement = null;
  selectedFriends = {};
  $("#select-meal").html("Select one");
  $("#select-location").html("Select one");
  $("#select-friends").html("Select friends");
  return $("#announce").addClass("ui-disabled");
};

handleGenericError = function(e) {
  return logResponse("Error ..." + JSON.stringify(e));
};

handlePublishOGError = function(e) {
  var errorCode;
  logResponse("Error publishing ..." + JSON.stringify(e));
  errorCode = e.code;
  logResponse("Error code ..." + errorCode);
  if (errorCode === "200") {
    return reauthorizeForPublishPermissions();
  }
};

reauthorizeForPublishPermissions = function() {
  logResponse("[reauthorizeForPublishPermissions] asking for additional permissions.");
  return FB.login((function(response) {
    if (!response || response.error) {
      return handleGenericError(response.error);
    } else {
      return publishOGAction(response);
    }
  }), {
    scope: "publish_actions"
  });
};

publishOGAction = function(response) {
  var errorHandler, friendIDArrays, friendId, params;
  errorHandler = null;
  if (!response || response.error) {
    errorHandler = handlePublishOGError;
  } else {
    errorHandler = handleGenericError;
  }
  logResponse("Publishing action...");
  params = {
    meal: meals[selectedMealIndex].url
  };
  if (selectedPlaceID) {
    params.place = selectedPlaceID;
  }
  friendIDArrays = [];
  for (friendId in selectedFriends) {
    if (selectedFriends.hasOwnProperty(friendId)) {
      friendIDArrays.push(friendId);
    }
  }
  if (friendIDArrays.length > 0) {
    params.tags = friendIDArrays.join();
  }
  logResponse("Publish params " + JSON.stringify(params));
  return $.ajax({
    url: "/announce",
    type: "post",
    data: params
  }).success(function(result) {
    return handleOGSuccess(result);
  }).error(function(xhr) {
    try {
      response = JSON.parse(xhr.responseText);
      if (response.error && response.redirectUri) {
        return window.location = response.redirectUri;
      }
    } catch (_error) {}
  });
};

showPublishConfirmation = function() {
  $("#confirmation").append("<p>Publish successful</p>");
  return $("#confirmation").fadeOut(3000, function() {
    $("#confirmation").html("");
    return $("#confirmation").show();
  });
};

displayMealList = function() {
  var output, tmpl;
  logResponse("[displayMealList] displaying meal list.");
  tmpl = $("#meal_list_tmpl").html();
  output = Mustache.to_html(tmpl, meals);
  return $("#meal-list").html(output).listview("refresh");
};

displaySelectedMeal = function() {
  var meal, output, tmpl;
  logResponse("[displaySelectedMeal] displaying selected meal.");
  meal = meals[selectedMealIndex];
  tmpl = $("#selected_meal_tmpl").html();
  output = Mustache.to_html(tmpl, meal);
  return $("#selected_meal").html(output);
};

window.getNearby = function() {
  if (nearbyPlaces) {
    return;
  }
  logResponse("[getNearby] get nearby data.");
  return navigator.geolocation.getCurrentPosition(function(location) {
    logResponse(location);
    return $.ajax({
      url: "/search",
      data: {
        type: "place",
        q: "restaurant",
        center: location.coords.latitude + "," + location.coords.longitude,
        distance: 1000,
        fields: "id,name,picture"
      }
    }).success(function(response) {
      nearbyPlaces = response.data;
      logResponse(nearbyPlaces);
      return displayPlaces(nearbyPlaces);
    }).error(function(err) {
      return logResponse("Error fetching nearby place data.");
    });
  });
};

displayPlaces = function(places) {
  var output, tmpl;
  logResponse("[displayPlaces] displaying nearby list.");
  tmpl = $("#places_list_tmpl").html();
  output = Mustache.to_html(tmpl, places);
  return $("#places-list").html(output).listview("refresh");
};

window.getFriends = function() {
  if (myFriends) {
    return;
  }
  logResponse("[getFriends] get friend data.");
  return $.ajax({
    url: "/friends"
  }).success(function(response) {
    myFriends = response.data;
    logResponse(myFriends);
    return displayFriends(myFriends);
  }).error(function(err) {
    return logResponse("Error fetching friend data.");
  });
};

displayFriends = function(friends) {
  var output, tmpl;
  logResponse("[displayFriends] displaying friend list.");
  tmpl = $("#friends_list_tmpl").html();
  output = Mustache.to_html(tmpl, friends);
  return $("#friends-list").html(output).listview("refresh");
};

$(function() {
  $("#logout").click(function() {
    window.location = "/logout";
    return false;
  });
  $("#announce").click(function() {
    return publishOGAction(null);
  });
  $("#meal-list").on("click", "li", function() {
    selectedMealIndex = $(this).index();
    logResponse("Link in meal listview clicked... " + selectedMealIndex);
    return displaySelectedMeal();
  });
  $("#detail-meal-select").click(function() {
    $("#announce").removeClass("ui-disabled");
    return $("#select-meal").html(meals[selectedMealIndex].title);
  });
  $("#places-list").on("click", "li", function() {
    var selectionId, selectionStatus;
    selectionId = $(this).attr("data-name");
    logResponse("Selected place " + selectionId);
    selectionStatus = $(this).attr("data-icon");
    if (selectionStatus === "false") {
      if (currentlySelectedPlaceElement) {
        currentlySelectedPlaceElement.buttonMarkup({
          icon: false
        });
      }
      $(this).buttonMarkup({
        icon: "check"
      });
      selectedPlaceID = selectionId;
      selectedPlaceIndex = $(this).index();
      $("#select-location").html(nearbyPlaces[selectedPlaceIndex].name);
      return currentlySelectedPlaceElement = $(this);
    } else {
      $(this).buttonMarkup({
        icon: false
      });
      selectedPlaceID = null;
      selectedPlaceIndex = -1;
      return $("#select-location").html("Select one");
    }
  });
  return $("#friends-list").on("click", "li", function() {
    var friendId, friendNameArray, otherFriends, selectedIndex, selectionId, selectionStatus;
    selectionId = $(this).attr("data-name");
    logResponse("Selected friend " + selectionId);
    selectedIndex = $(this).index();
    selectionStatus = $(this).attr("data-icon");
    if (selectionStatus === "false") {
      $(this).buttonMarkup({
        icon: "check"
      });
      selectedFriends[selectionId] = myFriends[selectedIndex].name;
    } else {
      $(this).buttonMarkup({
        icon: false
      });
      delete selectedFriends[selectionId];
    }
    friendNameArray = [];
    for (friendId in selectedFriends) {
      if (selectedFriends.hasOwnProperty(friendId)) {
        friendNameArray.push(selectedFriends[friendId]);
      }
    }
    if (friendNameArray.length > 2) {
      otherFriends = friendNameArray.length - 1;
      $("#select-friends").html(friendNameArray[0] + " and " + otherFriends + " others");
    } else if (friendNameArray.length === 2) {
      $("#select-friends").html(friendNameArray[0] + " and " + friendNameArray[1]);
    } else if (friendNameArray.length === 1) {
      $("#select-friends").html(friendNameArray[0]);
    } else {
      $("#select-friends").html("Select friends");
    }
    return logResponse("Current select friends list: " + selectedFriends);
  });
});

$(document).delegate("#meals", "pageinit", function() {
  return displayMealList();
});

$("body").bind("hideOpenMenus", function() {
  return $("ul:jqmData(role='menu')").find("li > ul").hide();
});

menuHandler = function(e) {
  $("body").trigger("hideOpenMenus");
  $(this).find("li > ul").show();
  return e.stopPropagation();
};

$("ul:jqmData(role='menu') li > ul li").click(function(e) {
  $("body").trigger("hideOpenMenus");
  return e.stopPropagation();
});

$("body").delegate("ul:jqmData(role='menu')", "click", menuHandler);

$("body").click(function(e) {
  return $("body").trigger("hideOpenMenus");
});

},{}]},{},[1])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9icnVjZS9PcGVuU2hpZnQvZnJvZG8vdG1wL3NjcnVtcHRpb3VzL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBERUJVR19NT0RFLCBjdXJyZW50bHlTZWxlY3RlZFBsYWNlRWxlbWVudCwgZGlzcGxheUZyaWVuZHMsIGRpc3BsYXlNZWFsTGlzdCwgZGlzcGxheVBsYWNlcywgZGlzcGxheVNlbGVjdGVkTWVhbCwgaGFuZGxlR2VuZXJpY0Vycm9yLCBoYW5kbGVPR1N1Y2Nlc3MsIGhhbmRsZVB1Ymxpc2hPR0Vycm9yLCBoYW5kbGVTdGF0dXNDaGFuZ2UsIGxvZ1Jlc3BvbnNlLCBtZWFscywgbWVudUhhbmRsZXIsIG15RnJpZW5kcywgbmVhcmJ5UGxhY2VzLCBwdWJsaXNoT0dBY3Rpb24sIHJlYXV0aG9yaXplRm9yUHVibGlzaFBlcm1pc3Npb25zLCBzZWxlY3RlZEZyaWVuZHMsIHNlbGVjdGVkTWVhbEluZGV4LCBzZWxlY3RlZFBsYWNlSUQsIHNlbGVjdGVkUGxhY2VJbmRleCwgc2hvd1B1Ymxpc2hDb25maXJtYXRpb24sIHVwZGF0ZVVzZXJJbmZvO1xuXG5ERUJVR19NT0RFID0gZmFsc2U7XG5cbnNlbGVjdGVkTWVhbEluZGV4ID0gLTE7XG5cbnNlbGVjdGVkUGxhY2VJbmRleCA9IC0xO1xuXG5zZWxlY3RlZFBsYWNlSUQgPSBudWxsO1xuXG5uZWFyYnlQbGFjZXMgPSBudWxsO1xuXG5teUZyaWVuZHMgPSBudWxsO1xuXG5jdXJyZW50bHlTZWxlY3RlZFBsYWNlRWxlbWVudCA9IG51bGw7XG5cbnNlbGVjdGVkRnJpZW5kcyA9IHt9O1xuXG5tZWFscyA9IFtcbiAge1xuICAgIGlkOiBcImNoZWVzZWJ1cmdlclwiLFxuICAgIHRpdGxlOiBcIkNoZWVzZWJ1cmdlclwiLFxuICAgIHVybDogXCJodHRwOi8vbm9kZXNjcnVtcHRpb3VzLmF6dXJld2Vic2l0ZXMubmV0L21lYWxzL2NoZWVzZWJ1cmdlclwiXG4gIH0sIHtcbiAgICBpZDogXCJjaGluZXNlXCIsXG4gICAgdGl0bGU6IFwiQ2hpbmVzZVwiLFxuICAgIHVybDogXCJodHRwOi8vbm9kZXNjcnVtcHRpb3VzLmF6dXJld2Vic2l0ZXMubmV0L21lYWxzL2NoaW5lc2VcIlxuICB9LCB7XG4gICAgaWQ6IFwiZnJlbmNoXCIsXG4gICAgdGl0bGU6IFwiRnJlbmNoXCIsXG4gICAgdXJsOiBcImh0dHA6Ly9ub2Rlc2NydW1wdGlvdXMuYXp1cmV3ZWJzaXRlcy5uZXQvbWVhbHMvZnJlbmNoXCJcbiAgfSwge1xuICAgIGlkOiBcImhvdGRvZ1wiLFxuICAgIHRpdGxlOiBcIkhvdCBEb2dcIixcbiAgICB1cmw6IFwiaHR0cDovL25vZGVzY3J1bXB0aW91cy5henVyZXdlYnNpdGVzLm5ldC9tZWFscy9ob3Rkb2dcIlxuICB9LCB7XG4gICAgaWQ6IFwiaW5kaWFuXCIsXG4gICAgdGl0bGU6IFwiSW5kaWFuXCIsXG4gICAgdXJsOiBcImh0dHA6Ly9ub2Rlc2NydW1wdGlvdXMuYXp1cmV3ZWJzaXRlcy5uZXQvbWVhbHMvaW5kaWFuXCJcbiAgfSwge1xuICAgIGlkOiBcIml0YWxpYW5cIixcbiAgICB0aXRsZTogXCJJdGFsaWFuXCIsXG4gICAgdXJsOiBcImh0dHA6Ly9ub2Rlc2NydW1wdGlvdXMuYXp1cmV3ZWJzaXRlcy5uZXQvbWVhbHMvaXRhbGlhblwiXG4gIH0sIHtcbiAgICBpZDogXCJwaXp6YVwiLFxuICAgIHRpdGxlOiBcIlBpenphXCIsXG4gICAgdXJsOiBcImh0dHA6Ly9ub2Rlc2NydW1wdGlvdXMuYXp1cmV3ZWJzaXRlcy5uZXQvbWVhbHMvcGl6emFcIlxuICB9XG5dO1xuXG5sb2dSZXNwb25zZSA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHJldHVybiBjb25zb2xlLmxvZyhcIlRoZSByZXNwb25zZSB3YXNcIiwgcmVzcG9uc2UpO1xuICB9XG59O1xuXG5oYW5kbGVTdGF0dXNDaGFuZ2UgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICBpZiAocmVzcG9uc2UuYXV0aFJlc3BvbnNlKSB7XG4gICAgbG9nUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gXCIjbWVudVwiO1xuICAgIHJldHVybiB1cGRhdGVVc2VySW5mbyhyZXNwb25zZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gXCIjbG9naW5cIjtcbiAgfVxufTtcblxudXBkYXRlVXNlckluZm8gPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICByZXR1cm4gRkIuYXBpKFwiL21lXCIsIHtcbiAgICBmaWVsZHM6IFwibmFtZSxmaXJzdF9uYW1lLHBpY3R1cmVcIlxuICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgIHZhciBvdXRwdXQ7XG4gICAgbG9nUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIG91dHB1dCA9IFwiXCI7XG4gICAgb3V0cHV0ICs9IFwiPGltZyBzcmM9XFxcIlwiICsgcmVzcG9uc2UucGljdHVyZS5kYXRhLnVybCArIFwiXFxcIiB3aWR0aD1cXFwiMjVcXFwiIGhlaWdodD1cXFwiMjVcXFwiPjwvaW1nPlwiO1xuICAgIG91dHB1dCArPSBcIiBcIiArIHJlc3BvbnNlLmZpcnN0X25hbWU7XG4gICAgcmV0dXJuICQoXCIjdXNlci1pZGVudGl0eVwiKS5odG1sKG91dHB1dCk7XG4gIH0pO1xufTtcblxuaGFuZGxlT0dTdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gIGxvZ1Jlc3BvbnNlKFwiW2hhbmRsZU9HU3VjY2Vzc10gZG9uZS5cIik7XG4gIHNob3dQdWJsaXNoQ29uZmlybWF0aW9uKCk7XG4gIHNlbGVjdGVkTWVhbEluZGV4ID0gLTE7XG4gIHNlbGVjdGVkUGxhY2VJbmRleCA9IC0xO1xuICBzZWxlY3RlZFBsYWNlSUQgPSBudWxsO1xuICBjdXJyZW50bHlTZWxlY3RlZFBsYWNlRWxlbWVudCA9IG51bGw7XG4gIHNlbGVjdGVkRnJpZW5kcyA9IHt9O1xuICAkKFwiI3NlbGVjdC1tZWFsXCIpLmh0bWwoXCJTZWxlY3Qgb25lXCIpO1xuICAkKFwiI3NlbGVjdC1sb2NhdGlvblwiKS5odG1sKFwiU2VsZWN0IG9uZVwiKTtcbiAgJChcIiNzZWxlY3QtZnJpZW5kc1wiKS5odG1sKFwiU2VsZWN0IGZyaWVuZHNcIik7XG4gIHJldHVybiAkKFwiI2Fubm91bmNlXCIpLmFkZENsYXNzKFwidWktZGlzYWJsZWRcIik7XG59O1xuXG5oYW5kbGVHZW5lcmljRXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gIHJldHVybiBsb2dSZXNwb25zZShcIkVycm9yIC4uLlwiICsgSlNPTi5zdHJpbmdpZnkoZSkpO1xufTtcblxuaGFuZGxlUHVibGlzaE9HRXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gIHZhciBlcnJvckNvZGU7XG4gIGxvZ1Jlc3BvbnNlKFwiRXJyb3IgcHVibGlzaGluZyAuLi5cIiArIEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgZXJyb3JDb2RlID0gZS5jb2RlO1xuICBsb2dSZXNwb25zZShcIkVycm9yIGNvZGUgLi4uXCIgKyBlcnJvckNvZGUpO1xuICBpZiAoZXJyb3JDb2RlID09PSBcIjIwMFwiKSB7XG4gICAgcmV0dXJuIHJlYXV0aG9yaXplRm9yUHVibGlzaFBlcm1pc3Npb25zKCk7XG4gIH1cbn07XG5cbnJlYXV0aG9yaXplRm9yUHVibGlzaFBlcm1pc3Npb25zID0gZnVuY3Rpb24oKSB7XG4gIGxvZ1Jlc3BvbnNlKFwiW3JlYXV0aG9yaXplRm9yUHVibGlzaFBlcm1pc3Npb25zXSBhc2tpbmcgZm9yIGFkZGl0aW9uYWwgcGVybWlzc2lvbnMuXCIpO1xuICByZXR1cm4gRkIubG9naW4oKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5lcnJvcikge1xuICAgICAgcmV0dXJuIGhhbmRsZUdlbmVyaWNFcnJvcihyZXNwb25zZS5lcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwdWJsaXNoT0dBY3Rpb24ocmVzcG9uc2UpO1xuICAgIH1cbiAgfSksIHtcbiAgICBzY29wZTogXCJwdWJsaXNoX2FjdGlvbnNcIlxuICB9KTtcbn07XG5cbnB1Ymxpc2hPR0FjdGlvbiA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gIHZhciBlcnJvckhhbmRsZXIsIGZyaWVuZElEQXJyYXlzLCBmcmllbmRJZCwgcGFyYW1zO1xuICBlcnJvckhhbmRsZXIgPSBudWxsO1xuICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLmVycm9yKSB7XG4gICAgZXJyb3JIYW5kbGVyID0gaGFuZGxlUHVibGlzaE9HRXJyb3I7XG4gIH0gZWxzZSB7XG4gICAgZXJyb3JIYW5kbGVyID0gaGFuZGxlR2VuZXJpY0Vycm9yO1xuICB9XG4gIGxvZ1Jlc3BvbnNlKFwiUHVibGlzaGluZyBhY3Rpb24uLi5cIik7XG4gIHBhcmFtcyA9IHtcbiAgICBtZWFsOiBtZWFsc1tzZWxlY3RlZE1lYWxJbmRleF0udXJsXG4gIH07XG4gIGlmIChzZWxlY3RlZFBsYWNlSUQpIHtcbiAgICBwYXJhbXMucGxhY2UgPSBzZWxlY3RlZFBsYWNlSUQ7XG4gIH1cbiAgZnJpZW5kSURBcnJheXMgPSBbXTtcbiAgZm9yIChmcmllbmRJZCBpbiBzZWxlY3RlZEZyaWVuZHMpIHtcbiAgICBpZiAoc2VsZWN0ZWRGcmllbmRzLmhhc093blByb3BlcnR5KGZyaWVuZElkKSkge1xuICAgICAgZnJpZW5kSURBcnJheXMucHVzaChmcmllbmRJZCk7XG4gICAgfVxuICB9XG4gIGlmIChmcmllbmRJREFycmF5cy5sZW5ndGggPiAwKSB7XG4gICAgcGFyYW1zLnRhZ3MgPSBmcmllbmRJREFycmF5cy5qb2luKCk7XG4gIH1cbiAgbG9nUmVzcG9uc2UoXCJQdWJsaXNoIHBhcmFtcyBcIiArIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICByZXR1cm4gJC5hamF4KHtcbiAgICB1cmw6IFwiL2Fubm91bmNlXCIsXG4gICAgdHlwZTogXCJwb3N0XCIsXG4gICAgZGF0YTogcGFyYW1zXG4gIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgcmV0dXJuIGhhbmRsZU9HU3VjY2VzcyhyZXN1bHQpO1xuICB9KS5lcnJvcihmdW5jdGlvbih4aHIpIHtcbiAgICB0cnkge1xuICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgaWYgKHJlc3BvbnNlLmVycm9yICYmIHJlc3BvbnNlLnJlZGlyZWN0VXJpKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5yZWRpcmVjdFVyaTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChfZXJyb3IpIHt9XG4gIH0pO1xufTtcblxuc2hvd1B1Ymxpc2hDb25maXJtYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgJChcIiNjb25maXJtYXRpb25cIikuYXBwZW5kKFwiPHA+UHVibGlzaCBzdWNjZXNzZnVsPC9wPlwiKTtcbiAgcmV0dXJuICQoXCIjY29uZmlybWF0aW9uXCIpLmZhZGVPdXQoMzAwMCwgZnVuY3Rpb24oKSB7XG4gICAgJChcIiNjb25maXJtYXRpb25cIikuaHRtbChcIlwiKTtcbiAgICByZXR1cm4gJChcIiNjb25maXJtYXRpb25cIikuc2hvdygpO1xuICB9KTtcbn07XG5cbmRpc3BsYXlNZWFsTGlzdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgb3V0cHV0LCB0bXBsO1xuICBsb2dSZXNwb25zZShcIltkaXNwbGF5TWVhbExpc3RdIGRpc3BsYXlpbmcgbWVhbCBsaXN0LlwiKTtcbiAgdG1wbCA9ICQoXCIjbWVhbF9saXN0X3RtcGxcIikuaHRtbCgpO1xuICBvdXRwdXQgPSBNdXN0YWNoZS50b19odG1sKHRtcGwsIG1lYWxzKTtcbiAgcmV0dXJuICQoXCIjbWVhbC1saXN0XCIpLmh0bWwob3V0cHV0KS5saXN0dmlldyhcInJlZnJlc2hcIik7XG59O1xuXG5kaXNwbGF5U2VsZWN0ZWRNZWFsID0gZnVuY3Rpb24oKSB7XG4gIHZhciBtZWFsLCBvdXRwdXQsIHRtcGw7XG4gIGxvZ1Jlc3BvbnNlKFwiW2Rpc3BsYXlTZWxlY3RlZE1lYWxdIGRpc3BsYXlpbmcgc2VsZWN0ZWQgbWVhbC5cIik7XG4gIG1lYWwgPSBtZWFsc1tzZWxlY3RlZE1lYWxJbmRleF07XG4gIHRtcGwgPSAkKFwiI3NlbGVjdGVkX21lYWxfdG1wbFwiKS5odG1sKCk7XG4gIG91dHB1dCA9IE11c3RhY2hlLnRvX2h0bWwodG1wbCwgbWVhbCk7XG4gIHJldHVybiAkKFwiI3NlbGVjdGVkX21lYWxcIikuaHRtbChvdXRwdXQpO1xufTtcblxud2luZG93LmdldE5lYXJieSA9IGZ1bmN0aW9uKCkge1xuICBpZiAobmVhcmJ5UGxhY2VzKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxvZ1Jlc3BvbnNlKFwiW2dldE5lYXJieV0gZ2V0IG5lYXJieSBkYXRhLlwiKTtcbiAgcmV0dXJuIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZnVuY3Rpb24obG9jYXRpb24pIHtcbiAgICBsb2dSZXNwb25zZShsb2NhdGlvbik7XG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICB1cmw6IFwiL3NlYXJjaFwiLFxuICAgICAgZGF0YToge1xuICAgICAgICB0eXBlOiBcInBsYWNlXCIsXG4gICAgICAgIHE6IFwicmVzdGF1cmFudFwiLFxuICAgICAgICBjZW50ZXI6IGxvY2F0aW9uLmNvb3Jkcy5sYXRpdHVkZSArIFwiLFwiICsgbG9jYXRpb24uY29vcmRzLmxvbmdpdHVkZSxcbiAgICAgICAgZGlzdGFuY2U6IDEwMDAsXG4gICAgICAgIGZpZWxkczogXCJpZCxuYW1lLHBpY3R1cmVcIlxuICAgICAgfVxuICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIG5lYXJieVBsYWNlcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICBsb2dSZXNwb25zZShuZWFyYnlQbGFjZXMpO1xuICAgICAgcmV0dXJuIGRpc3BsYXlQbGFjZXMobmVhcmJ5UGxhY2VzKTtcbiAgICB9KS5lcnJvcihmdW5jdGlvbihlcnIpIHtcbiAgICAgIHJldHVybiBsb2dSZXNwb25zZShcIkVycm9yIGZldGNoaW5nIG5lYXJieSBwbGFjZSBkYXRhLlwiKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5kaXNwbGF5UGxhY2VzID0gZnVuY3Rpb24ocGxhY2VzKSB7XG4gIHZhciBvdXRwdXQsIHRtcGw7XG4gIGxvZ1Jlc3BvbnNlKFwiW2Rpc3BsYXlQbGFjZXNdIGRpc3BsYXlpbmcgbmVhcmJ5IGxpc3QuXCIpO1xuICB0bXBsID0gJChcIiNwbGFjZXNfbGlzdF90bXBsXCIpLmh0bWwoKTtcbiAgb3V0cHV0ID0gTXVzdGFjaGUudG9faHRtbCh0bXBsLCBwbGFjZXMpO1xuICByZXR1cm4gJChcIiNwbGFjZXMtbGlzdFwiKS5odG1sKG91dHB1dCkubGlzdHZpZXcoXCJyZWZyZXNoXCIpO1xufTtcblxud2luZG93LmdldEZyaWVuZHMgPSBmdW5jdGlvbigpIHtcbiAgaWYgKG15RnJpZW5kcykge1xuICAgIHJldHVybjtcbiAgfVxuICBsb2dSZXNwb25zZShcIltnZXRGcmllbmRzXSBnZXQgZnJpZW5kIGRhdGEuXCIpO1xuICByZXR1cm4gJC5hamF4KHtcbiAgICB1cmw6IFwiL2ZyaWVuZHNcIlxuICB9KS5zdWNjZXNzKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgbXlGcmllbmRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICBsb2dSZXNwb25zZShteUZyaWVuZHMpO1xuICAgIHJldHVybiBkaXNwbGF5RnJpZW5kcyhteUZyaWVuZHMpO1xuICB9KS5lcnJvcihmdW5jdGlvbihlcnIpIHtcbiAgICByZXR1cm4gbG9nUmVzcG9uc2UoXCJFcnJvciBmZXRjaGluZyBmcmllbmQgZGF0YS5cIik7XG4gIH0pO1xufTtcblxuZGlzcGxheUZyaWVuZHMgPSBmdW5jdGlvbihmcmllbmRzKSB7XG4gIHZhciBvdXRwdXQsIHRtcGw7XG4gIGxvZ1Jlc3BvbnNlKFwiW2Rpc3BsYXlGcmllbmRzXSBkaXNwbGF5aW5nIGZyaWVuZCBsaXN0LlwiKTtcbiAgdG1wbCA9ICQoXCIjZnJpZW5kc19saXN0X3RtcGxcIikuaHRtbCgpO1xuICBvdXRwdXQgPSBNdXN0YWNoZS50b19odG1sKHRtcGwsIGZyaWVuZHMpO1xuICByZXR1cm4gJChcIiNmcmllbmRzLWxpc3RcIikuaHRtbChvdXRwdXQpLmxpc3R2aWV3KFwicmVmcmVzaFwiKTtcbn07XG5cbiQoZnVuY3Rpb24oKSB7XG4gICQoXCIjbG9nb3V0XCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL2xvZ291dFwiO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG4gICQoXCIjYW5ub3VuY2VcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHB1Ymxpc2hPR0FjdGlvbihudWxsKTtcbiAgfSk7XG4gICQoXCIjbWVhbC1saXN0XCIpLm9uKFwiY2xpY2tcIiwgXCJsaVwiLCBmdW5jdGlvbigpIHtcbiAgICBzZWxlY3RlZE1lYWxJbmRleCA9ICQodGhpcykuaW5kZXgoKTtcbiAgICBsb2dSZXNwb25zZShcIkxpbmsgaW4gbWVhbCBsaXN0dmlldyBjbGlja2VkLi4uIFwiICsgc2VsZWN0ZWRNZWFsSW5kZXgpO1xuICAgIHJldHVybiBkaXNwbGF5U2VsZWN0ZWRNZWFsKCk7XG4gIH0pO1xuICAkKFwiI2RldGFpbC1tZWFsLXNlbGVjdFwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKFwiI2Fubm91bmNlXCIpLnJlbW92ZUNsYXNzKFwidWktZGlzYWJsZWRcIik7XG4gICAgcmV0dXJuICQoXCIjc2VsZWN0LW1lYWxcIikuaHRtbChtZWFsc1tzZWxlY3RlZE1lYWxJbmRleF0udGl0bGUpO1xuICB9KTtcbiAgJChcIiNwbGFjZXMtbGlzdFwiKS5vbihcImNsaWNrXCIsIFwibGlcIiwgZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdGlvbklkLCBzZWxlY3Rpb25TdGF0dXM7XG4gICAgc2VsZWN0aW9uSWQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLW5hbWVcIik7XG4gICAgbG9nUmVzcG9uc2UoXCJTZWxlY3RlZCBwbGFjZSBcIiArIHNlbGVjdGlvbklkKTtcbiAgICBzZWxlY3Rpb25TdGF0dXMgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWljb25cIik7XG4gICAgaWYgKHNlbGVjdGlvblN0YXR1cyA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICBpZiAoY3VycmVudGx5U2VsZWN0ZWRQbGFjZUVsZW1lbnQpIHtcbiAgICAgICAgY3VycmVudGx5U2VsZWN0ZWRQbGFjZUVsZW1lbnQuYnV0dG9uTWFya3VwKHtcbiAgICAgICAgICBpY29uOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgICQodGhpcykuYnV0dG9uTWFya3VwKHtcbiAgICAgICAgaWNvbjogXCJjaGVja1wiXG4gICAgICB9KTtcbiAgICAgIHNlbGVjdGVkUGxhY2VJRCA9IHNlbGVjdGlvbklkO1xuICAgICAgc2VsZWN0ZWRQbGFjZUluZGV4ID0gJCh0aGlzKS5pbmRleCgpO1xuICAgICAgJChcIiNzZWxlY3QtbG9jYXRpb25cIikuaHRtbChuZWFyYnlQbGFjZXNbc2VsZWN0ZWRQbGFjZUluZGV4XS5uYW1lKTtcbiAgICAgIHJldHVybiBjdXJyZW50bHlTZWxlY3RlZFBsYWNlRWxlbWVudCA9ICQodGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQodGhpcykuYnV0dG9uTWFya3VwKHtcbiAgICAgICAgaWNvbjogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgc2VsZWN0ZWRQbGFjZUlEID0gbnVsbDtcbiAgICAgIHNlbGVjdGVkUGxhY2VJbmRleCA9IC0xO1xuICAgICAgcmV0dXJuICQoXCIjc2VsZWN0LWxvY2F0aW9uXCIpLmh0bWwoXCJTZWxlY3Qgb25lXCIpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiAkKFwiI2ZyaWVuZHMtbGlzdFwiKS5vbihcImNsaWNrXCIsIFwibGlcIiwgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZyaWVuZElkLCBmcmllbmROYW1lQXJyYXksIG90aGVyRnJpZW5kcywgc2VsZWN0ZWRJbmRleCwgc2VsZWN0aW9uSWQsIHNlbGVjdGlvblN0YXR1cztcbiAgICBzZWxlY3Rpb25JZCA9ICQodGhpcykuYXR0cihcImRhdGEtbmFtZVwiKTtcbiAgICBsb2dSZXNwb25zZShcIlNlbGVjdGVkIGZyaWVuZCBcIiArIHNlbGVjdGlvbklkKTtcbiAgICBzZWxlY3RlZEluZGV4ID0gJCh0aGlzKS5pbmRleCgpO1xuICAgIHNlbGVjdGlvblN0YXR1cyA9ICQodGhpcykuYXR0cihcImRhdGEtaWNvblwiKTtcbiAgICBpZiAoc2VsZWN0aW9uU3RhdHVzID09PSBcImZhbHNlXCIpIHtcbiAgICAgICQodGhpcykuYnV0dG9uTWFya3VwKHtcbiAgICAgICAgaWNvbjogXCJjaGVja1wiXG4gICAgICB9KTtcbiAgICAgIHNlbGVjdGVkRnJpZW5kc1tzZWxlY3Rpb25JZF0gPSBteUZyaWVuZHNbc2VsZWN0ZWRJbmRleF0ubmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCh0aGlzKS5idXR0b25NYXJrdXAoe1xuICAgICAgICBpY29uOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBkZWxldGUgc2VsZWN0ZWRGcmllbmRzW3NlbGVjdGlvbklkXTtcbiAgICB9XG4gICAgZnJpZW5kTmFtZUFycmF5ID0gW107XG4gICAgZm9yIChmcmllbmRJZCBpbiBzZWxlY3RlZEZyaWVuZHMpIHtcbiAgICAgIGlmIChzZWxlY3RlZEZyaWVuZHMuaGFzT3duUHJvcGVydHkoZnJpZW5kSWQpKSB7XG4gICAgICAgIGZyaWVuZE5hbWVBcnJheS5wdXNoKHNlbGVjdGVkRnJpZW5kc1tmcmllbmRJZF0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZnJpZW5kTmFtZUFycmF5Lmxlbmd0aCA+IDIpIHtcbiAgICAgIG90aGVyRnJpZW5kcyA9IGZyaWVuZE5hbWVBcnJheS5sZW5ndGggLSAxO1xuICAgICAgJChcIiNzZWxlY3QtZnJpZW5kc1wiKS5odG1sKGZyaWVuZE5hbWVBcnJheVswXSArIFwiIGFuZCBcIiArIG90aGVyRnJpZW5kcyArIFwiIG90aGVyc1wiKTtcbiAgICB9IGVsc2UgaWYgKGZyaWVuZE5hbWVBcnJheS5sZW5ndGggPT09IDIpIHtcbiAgICAgICQoXCIjc2VsZWN0LWZyaWVuZHNcIikuaHRtbChmcmllbmROYW1lQXJyYXlbMF0gKyBcIiBhbmQgXCIgKyBmcmllbmROYW1lQXJyYXlbMV0pO1xuICAgIH0gZWxzZSBpZiAoZnJpZW5kTmFtZUFycmF5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgJChcIiNzZWxlY3QtZnJpZW5kc1wiKS5odG1sKGZyaWVuZE5hbWVBcnJheVswXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoXCIjc2VsZWN0LWZyaWVuZHNcIikuaHRtbChcIlNlbGVjdCBmcmllbmRzXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nUmVzcG9uc2UoXCJDdXJyZW50IHNlbGVjdCBmcmllbmRzIGxpc3Q6IFwiICsgc2VsZWN0ZWRGcmllbmRzKTtcbiAgfSk7XG59KTtcblxuJChkb2N1bWVudCkuZGVsZWdhdGUoXCIjbWVhbHNcIiwgXCJwYWdlaW5pdFwiLCBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIGRpc3BsYXlNZWFsTGlzdCgpO1xufSk7XG5cbiQoXCJib2R5XCIpLmJpbmQoXCJoaWRlT3Blbk1lbnVzXCIsIGZ1bmN0aW9uKCkge1xuICByZXR1cm4gJChcInVsOmpxbURhdGEocm9sZT0nbWVudScpXCIpLmZpbmQoXCJsaSA+IHVsXCIpLmhpZGUoKTtcbn0pO1xuXG5tZW51SGFuZGxlciA9IGZ1bmN0aW9uKGUpIHtcbiAgJChcImJvZHlcIikudHJpZ2dlcihcImhpZGVPcGVuTWVudXNcIik7XG4gICQodGhpcykuZmluZChcImxpID4gdWxcIikuc2hvdygpO1xuICByZXR1cm4gZS5zdG9wUHJvcGFnYXRpb24oKTtcbn07XG5cbiQoXCJ1bDpqcW1EYXRhKHJvbGU9J21lbnUnKSBsaSA+IHVsIGxpXCIpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgJChcImJvZHlcIikudHJpZ2dlcihcImhpZGVPcGVuTWVudXNcIik7XG4gIHJldHVybiBlLnN0b3BQcm9wYWdhdGlvbigpO1xufSk7XG5cbiQoXCJib2R5XCIpLmRlbGVnYXRlKFwidWw6anFtRGF0YShyb2xlPSdtZW51JylcIiwgXCJjbGlja1wiLCBtZW51SGFuZGxlcik7XG5cbiQoXCJib2R5XCIpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgcmV0dXJuICQoXCJib2R5XCIpLnRyaWdnZXIoXCJoaWRlT3Blbk1lbnVzXCIpO1xufSk7XG4iXX0=
